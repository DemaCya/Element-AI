# AI 生成超时修复

## 修复内容

### 1. 增加API超时时间
- 在 `src/app/api/reports/generate/route.ts` 中添加了 `export const maxDuration = 60`
- 将API路由的超时时间从默认的10秒增加到60秒

### 2. 减少AI生成token数量
- 在 `src/services/zhipuService.ts` 中将 `max_tokens` 从 15000 减少到 8000
- 这样可以加快AI生成速度

### 3. 优化系统提示词
- 要求字数控制在8000字左右
- 为每个部分指定了字数限制
- 添加了"回答要快速，直接，避免过多冗余"的要求

### 4. 添加前端超时控制
- 在 `src/app/generate/page.tsx` 中添加了55秒的fetch超时
- 添加了更友好的错误提示
- 特别针对504错误显示"AI生成超时，请稍后重试"

### 5. 改进错误处理
- 当API返回504时显示友好的错误信息
- 添加了超时中断机制
- 清理进度interval和timeout

## 使用说明

现在AI生成报告时：
1. 显示进度环，用户可以看到生成进度
2. API有60秒的超时时间
3. 前端有55秒的超时检测
4. 如果超时会显示友好的错误提示

## 如果仍然超时

1. **检查Vercel计划**：Hobby计划有60秒限制，Pro计划有300秒
2. **减少字数**：可以进一步减少到6000字
3. **使用流式响应**：可以考虑实现流式输出
4. **检查网络**：确保API响应速度正常

